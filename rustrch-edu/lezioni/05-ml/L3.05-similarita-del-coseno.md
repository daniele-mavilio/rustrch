# Similarità del Coseno

## Teoria

La similarità del coseno è una misura di similarità tra due vettori che viene utilizzata per determinare quanto sono simili due documenti o testi in base ai loro embedding. Questa misura è particolarmente utile nella ricerca semantica perché permette di confrontare il significato semantico dei testi piuttosto che le parole chiave.

La similarità del coseno è definita come il coseno dell'angolo tra due vettori in uno spazio vettoriale. Il valore della similarità del coseno varia tra -1 e 1, dove 1 indica che i vettori sono identici, 0 indica che sono ortogonali (non correlati) e -1 indica che sono opposti. Tuttavia, nella pratica, gli embedding sono generalmente normalizzati in modo che la similarità del coseno vari tra 0 e 1.

La formula per calcolare la similarità del coseno tra due vettori A e B è la seguente:

similarità = (A · B) / (||A|| * ||B||)

dove A · B è il prodotto scalare tra i vettori A e B, e ||A|| e ||B|| sono le norme (lunghezze) dei vettori A e B.

## Esempio

Consideriamo un esempio pratico di come potremmo calcolare la similarità del coseno tra due embedding. Supponiamo di avere i seguenti embedding per due documenti:

- Documento 1: [0.2, 0.8, 0.1, 0.3]
- Documento 2: [0.3, 0.7, 0.2, 0.4]

Per calcolare la similarità del coseno tra questi due embedding, seguiamo questi passaggi:

1. Calcoliamo il prodotto scalare tra i due vettori:
   prodotto_scalare = (0.2 * 0.3) + (0.8 * 0.7) + (0.1 * 0.2) + (0.3 * 0.4) = 0.06 + 0.56 + 0.02 + 0.12 = 0.76

2. Calcoliamo la norma di ciascun vettore:
   norma_1 = sqrt((0.2^2) + (0.8^2) + (0.1^2) + (0.3^2)) = sqrt(0.04 + 0.64 + 0.01 + 0.09) = sqrt(0.78) ≈ 0.883
   norma_2 = sqrt((0.3^2) + (0.7^2) + (0.2^2) + (0.4^2)) = sqrt(0.09 + 0.49 + 0.04 + 0.16) = sqrt(0.78) ≈ 0.883

3. Calcoliamo la similarità del coseno:
   similarità = prodotto_scalare / (norma_1 * norma_2) = 0.76 / (0.883 * 0.883) ≈ 0.76 / 0.78 ≈ 0.974

Quindi, la similarità del coseno tra i due embedding è circa 0.974, il che indica che i due documenti sono molto simili semanticamente.

## Pseudocodice

Ecco uno pseudocodice che illustra come potremmo calcolare la similarità del coseno tra due embedding in Rust:

```rust
// Funzione per calcolare la similarità del coseno tra due vettori
funzione similarita_coseno(a: &Vec<f32>, b: &Vec<f32>) -> f32 {
    // Calcola il prodotto scalare tra i due vettori
    let prodotto_scalare = a.iter().zip(b.iter()).map(|(x, y)| x * y).sum::<f32>();
    
    // Calcola la norma di ciascun vettore
    let norma_a = (a.iter().map(|x| x * x).sum::<f32>()).sqrt();
    let norma_b = (b.iter().map(|x| x * x).sum::<f32>()).sqrt();
    
    // Calcola la similarità del coseno
    prodotto_scalare / (norma_a * norma_b)
}

// Funzione per trovare documenti simili utilizzando la similarità del coseno
funzione trova_simili(query_embedding: &Vec<f32>, documenti: &[Documento]) -> Vec<(Documento, f32)> {
    documenti.iter()
        .map(|doc| {
            let similarita = similarita_coseno(query_embedding, &doc.embedding);
            (doc.clone(), similarita)
        })
        .filter(|(_, similarita)| *similarita > 0.5) // Filtra risultati con similarità > 0.5
        .sort_by(|a, b| b.1.partial_cmp(&a.1).unwrap()) // Ordina per similarità decrescente
        .collect()
}
```

## Risorse

Ecco alcune risorse utili per approfondire la similarità del coseno:

1. [Cosine Similarity Explained](https://en.wikipedia.org/wiki/Cosine_similarity)
2. [Understanding Cosine Similarity](https://www.machinelearningplus.com/nlp/cosine-similarity/)
3. [Cosine Similarity in Machine Learning](https://towardsdatascience.com/cosine-similarity-in-machine-learning-3e6b55b952c8)

## Esercizio

Per consolidare quanto appreso, prova a rispondere alle seguenti domande:

1. **Cos'è la similarità del coseno e come viene utilizzata nella ricerca semantica?**
2. **Qual è la formula per calcolare la similarità del coseno tra due vettori?**
3. **Come possiamo utilizzare la similarità del coseno per trovare documenti simili?**

**Traccia di soluzione:**

1. La similarità del coseno è una misura di similarità tra due vettori che viene utilizzata per determinare quanto sono simili due documenti o testi in base ai loro embedding. È particolarmente utile nella ricerca semantica perché permette di confrontare il significato semantico dei testi piuttosto che le parole chiave.

2. La formula per calcolare la similarità del coseno tra due vettori A e B è: similarità = (A · B) / (||A|| * ||B||), dove A · B è il prodotto scalare tra i vettori A e B, e ||A|| e ||B|| sono le norme (lunghezze) dei vettori A e B.

3. Possiamo utilizzare la similarità del coseno per trovare documenti simili calcolando la similarità tra l'embedding della query e gli embedding dei documenti. Documenti con una similarità del coseno elevata sono semanticamente simili alla query.
