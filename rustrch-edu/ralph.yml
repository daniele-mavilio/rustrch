cli:
  backend: custom
  command: opencode
  args:
  - run
  - -m
  - openrouter/mistralai/devstral-2512
  prompt_mode: arg
event_loop:
  prompt_file: PROMPT.md
  completion_promise: LOOP_COMPLETE
  starting_event: edu.start
  max_iterations: 300
  checkpoint_interval: 2
  max_runtime_seconds: 28800
RObot:
  enabled: true
  timeout_seconds: 120
memories:
  enabled: true
  inject: auto
  budget: 4000
tasks:
  enabled: true
hats:
  architect:
    name: Architect
    description: Usa i file in specs/ per pianificare i prossimi 10-15 task.
    triggers:
    - edu.start
    publishes:
    - outline.ready
    instructions: |
      ## MISSIONE: DISCOVERY SPEC-DRIVEN
      1. Scansiona le directory in `lezioni/` per vedere dove siamo rimasti.
      2. Leggi il file `specs/*/PROMPT.md` corrispondente alla fase attuale.
      3. Trasforma le sezioni descritte in quel file in task granulari usando `ralph tools task add "[LX.YY] Titolo"`.
      4. NON creare 200 task. Crea MASSIMO 10-15 task per volta per mantenere il contesto pulito.
      5. Emetti `outline.ready` appena il DB è aggiornato.
  writer:
    name: Writer
    description: Produce contenuti e salva memorie per ogni sezione.
    triggers:
    - outline.ready
    - write.next
    - review.reject
    publishes:
    - section.written
    instructions: |
      ## MISSIONE: SCRITTURA DIDATTICA
      1. Prendi il PRIMO task pronto: `ralph tools task ready --format json | head -1`.
      2. Scrivi la sezione seguendo il format del PROMPT.md. Mantieniti sui 500-600 parole.
      3. Usa Mistral per generare spiegazioni tecniche eccellenti.
      4. DOPO il salvataggio: `ralph tools memory add "Visti i concetti in [TAG], ora sappiamo gestire [CONCETTO]" -t pedagogico`.
      5. Chiudi il task e emetti `section.written [PATH]`.
  reviewer:
    name: Reviewer
    description: Verifica che il file rispetti i criteri minimi.
    triggers:
    - section.written
    publishes:
    - review.approve
    - review.reject
    instructions: |
      ## VALIDAZIONE
      1. Controlla il file appena scritto. Deve avere: Teoria, Esempio, Pseudocodice (//), Risorse, Esercizio.
      2. Se mancano sezioni o è troppo corto (<300 parole), emetti `review.reject`.
      3. Se OK, emetti `review.approve`.
  coordinator:
    name: Coordinator
    description: Decide se andare avanti, ri-pianificare o finire.
    triggers:
    - review.approve
    publishes:
    - write.next
    - edu.start
    - LOOP_COMPLETE
    instructions: |
      1. Se ci sono ancora task 'open', emetti `write.next`.
      2. Se i task sono finiti ma mancano ancora intere lezioni (L4-L8), emetti `edu.start` per far pianificare il lotto successivo all'Architect.
      3. Se tutto il corso è completo (150-200 file), emetti `LOOP_COMPLETE`.
